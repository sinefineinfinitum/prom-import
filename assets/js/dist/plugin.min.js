!function(){"use strict";!function(t){const e={namespace:"spss12-prom-import/v1",endpoints:{product:"/import/product",categories:"/import/categories"},getUrl(t){return`${promImporterAjaxObj.rest_url}${this.namespace}${t}`},getNonce(){return promImporterAjaxObj.rest_nonce||wp.apiFetch?.nonceMiddleware?.nonce},async request(t,e={},r="POST"){try{const a=await fetch(this.getUrl(t),{method:r,headers:{"Content-Type":"application/json","X-WP-Nonce":this.getNonce()},body:JSON.stringify(e)}),o=await a.json();if(!a.ok)throw new Error(o.message||"Request failed");return o}catch(t){throw t}}};async function r(t,r,a,o,s,i,c){try{let t=c;if("string"==typeof t&&""!==t.trim())try{t=JSON.parse(t)}catch(e){t=[t]}const n={product_id:parseInt(r,10),product_title:a,product_description:o||"",product_price:parseFloat(s)||0,product_category:parseInt(i,10)||0,product_featured_media:Array.isArray(t)?t:[]},d=await e.request(e.endpoints.product,n);if(d.success&&d.data?.edit_url)return window.open(d.data.edit_url,"_blank"),d;throw new Error(d.message||"Import failed")}catch(t){throw alert(t.message||promImporterAjaxObj.error_text||"An error occurred"),t}}async function a(r,a){try{const r=[];if(t("#categories-table tbody tr").each(function(e,a){const o=t(a),s=t.trim(o.find("td").eq(0).find("span").text()),i=o.find("td").eq(2).find("select").val();""!==s&&void 0!==i&&r.push({id:s,selected:i})}),0===r.length)return void alert(promImporterAjaxObj.no_categories_text||"No categories selected");const o=await e.request(e.endpoints.categories,{categories:r});return o.success&&(a.text(promImporterAjaxObj.saved_text||"Saved").removeClass("import-category").attr("data-nonce","").prop("disabled",!0).addClass("button-disabled"),"string"==typeof o.message&&function(t,e="success"){"undefined"!=typeof wp&&wp.data&&wp.data.dispatch("core/notices")&&wp.data.dispatch("core/notices").createNotice(e,t,{isDismissible:!0})}(o.message,"success")),o}catch(t){throw alert(t.message||promImporterAjaxObj.error_text||"An error occurred"),t}}t(".import-product").on("click",async function(e){e.preventDefault();const a=t(this),o=a.text();a.prop("disabled",!0).text(promImporterAjaxObj.loading_text||"Importing...");try{await r(a.attr("data-nonce"),a.attr("data-id"),a.attr("data-title"),a.attr("data-description"),a.attr("data-price"),a.attr("data-category"),a.attr("data-featured-media")),a.text(promImporterAjaxObj.imported_text||"Imported").removeClass("import-product").addClass("button-disabled").attr("data-nonce","")}catch(t){a.prop("disabled",!1).text(o)}}),t("#import-categories").on("click",async function(e){e.preventDefault();const r=t(this),o=r.text();r.prop("disabled",!0).text(promImporterAjaxObj.loading_text||"Saving...");try{await a(r.attr("data-nonce"),r)}catch(t){r.prop("disabled",!1).text(o)}}),window.PromImporter={RestAPI:e,importProduct:r,importCategories:a}}(jQuery)}();
//# sourceMappingURL=plugin.min.js.map