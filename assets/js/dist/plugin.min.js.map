{"version":3,"file":"plugin.min.js","mappings":"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","sources":["webpack://spss12-import-prom-woo/./assets/js/src/plugin.js"],"sourcesContent":["(function($) {\r\n    \"use strict\";\r\n\r\n    /**\r\n     * REST API configuration\r\n     */\r\n    const RestAPI = {\r\n        namespace: 'spss12-prom-import/v1',\r\n        endpoints: {\r\n            product: '/import/product',\r\n            categories: '/import/categories'\r\n        },\r\n\r\n        /**\r\n         * Get full REST API URL\r\n         */\r\n        getUrl(endpoint) {\r\n            return `${promImporterAjaxObj.rest_url}${this.namespace}${endpoint}`;\r\n        },\r\n\r\n        /**\r\n         * Get nonce for REST API requests\r\n         */\r\n        getNonce() {\r\n            return promImporterAjaxObj.rest_nonce || wp.apiFetch?.nonceMiddleware?.nonce;\r\n        },\r\n\r\n        /**\r\n         * Make REST API request\r\n         */\r\n        async request(endpoint, data = {}, method = 'POST') {\r\n            try {\r\n                const response = await fetch(this.getUrl(endpoint), {\r\n                    method: method,\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'X-WP-Nonce': this.getNonce()\r\n                    },\r\n                    body: JSON.stringify(data)\r\n                });\r\n\r\n                const json = await response.json();\r\n\r\n                if (!response.ok) {\r\n                    throw new Error(json.message || 'Request failed');\r\n                }\r\n\r\n                return json;\r\n            } catch (error) {\r\n                console.error('REST API Error:', error);\r\n                throw error;\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Import single product via REST API\r\n     */\r\n    async function import_product(\r\n        nonce,\r\n        product_id,\r\n        product_title,\r\n        product_description,\r\n        product_price,\r\n        product_category,\r\n        product_featured_media\r\n    ) {\r\n        try {\r\n            // Parse media URLs if it's a JSON string\r\n            let mediaUrls = product_featured_media;\r\n            if (typeof mediaUrls === 'string' && mediaUrls.trim() !== '') {\r\n                try {\r\n                    mediaUrls = JSON.parse(mediaUrls);\r\n                } catch (e) {\r\n                    mediaUrls = [mediaUrls];\r\n                }\r\n            }\r\n\r\n            const data = {\r\n                product_id: parseInt(product_id, 10),\r\n                product_title: product_title,\r\n                product_description: product_description || '',\r\n                product_price: parseFloat(product_price) || 0,\r\n                product_category: parseInt(product_category, 10) || 0,\r\n                product_featured_media: Array.isArray(mediaUrls) ? mediaUrls : []\r\n            };\r\n\r\n            const response = await RestAPI.request(RestAPI.endpoints.product, data);\r\n\r\n            if (response.success && response.data?.edit_url) {\r\n                window.open(response.data.edit_url, '_blank');\r\n                return response;\r\n            } else {\r\n                throw new Error(response.message || 'Import failed');\r\n            }\r\n        } catch (error) {\r\n            alert(error.message || promImporterAjaxObj.error_text || 'An error occurred');\r\n            console.error('Product import error:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Import categories mapping via REST API\r\n     */\r\n    async function import_categories(nonce, btn) {\r\n        try {\r\n            const mappings = [];\r\n\r\n            // Iterate each row in categories table\r\n            $('#categories-table tbody tr').each(function(index, row) {\r\n                const $row = $(row);\r\n                // Column 1 contains XML category id inside span\r\n                const xmlId = $.trim($row.find('td').eq(0).find('span').text());\r\n                // The select is in the 3rd column\r\n                const $select = $row.find('td').eq(2).find('select');\r\n                const selectedValue = $select.val();\r\n\r\n                if (xmlId !== '' && typeof selectedValue !== 'undefined') {\r\n                    mappings.push({\r\n                        id: xmlId,          // Prom XML category id\r\n                        selected: selectedValue // Woo category (slug by current dropdown config)\r\n                    });\r\n                }\r\n            });\r\n\r\n\r\n            if (mappings.length === 0) {\r\n                alert(promImporterAjaxObj.no_categories_text || 'No categories selected');\r\n                return;\r\n            }\r\n\r\n            const response = await RestAPI.request(RestAPI.endpoints.categories, {\r\n                categories: mappings\r\n            });\r\n\r\n            if (response.success) {\r\n                btn\r\n                    .text(promImporterAjaxObj.saved_text || 'Saved')\r\n                    .removeClass('import-category')\r\n                    .attr('data-nonce', '')\r\n                    .prop('disabled', true)\r\n                    .addClass('button-disabled');\r\n\r\n                // Show success notice\r\n                if (typeof response.message === 'string') {\r\n                    showNotice(response.message, 'success');\r\n                }\r\n            }\r\n\r\n            return response;\r\n        } catch (error) {\r\n            alert(error.message || promImporterAjaxObj.error_text || 'An error occurred');\r\n            console.error('Categories import error:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show admin notice (if wp.notices available)\r\n     */\r\n    function showNotice(message, type = 'success') {\r\n        // Try wp.data notices (Gutenberg)\r\n        if (typeof wp !== 'undefined' && wp.data && wp.data.dispatch('core/notices')) {\r\n            wp.data.dispatch('core/notices').createNotice(type, message, {\r\n                isDismissible: true,\r\n            });\r\n        } else {\r\n            // Fallback: show browser alert\r\n            console.log(`[${type.toUpperCase()}] ${message}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Event Handlers\r\n     */\r\n\r\n    // Import single product button\r\n    $('.import-product').on('click', async function(event) {\r\n        event.preventDefault();\r\n\r\n        const $btn = $(this);\r\n        const originalText = $btn.text();\r\n\r\n        // Disable button and show loading state\r\n        $btn.prop('disabled', true).text(promImporterAjaxObj.loading_text || 'Importing...');\r\n\r\n        try {\r\n            await import_product(\r\n                $btn.attr('data-nonce'),\r\n                $btn.attr('data-id'),\r\n                $btn.attr('data-title'),\r\n                $btn.attr('data-description'),\r\n                $btn.attr('data-price'),\r\n                $btn.attr('data-category'),\r\n                $btn.attr('data-featured-media')\r\n            );\r\n\r\n            // Success: update button state\r\n            $btn\r\n                .text(promImporterAjaxObj.imported_text || 'Imported')\r\n                .removeClass('import-product')\r\n                .addClass('button-disabled')\r\n                .attr('data-nonce', '');\r\n        } catch (error) {\r\n            // Error: restore button\r\n            $btn.prop('disabled', false).text(originalText);\r\n        }\r\n    });\r\n\r\n    // Import categories button\r\n    $('#import-categories').on('click', async function(event) {\r\n        event.preventDefault();\r\n\r\n        const $btn = $(this);\r\n        const originalText = $btn.text();\r\n\r\n        // Disable button and show loading state\r\n        $btn.prop('disabled', true).text(promImporterAjaxObj.loading_text || 'Saving...');\r\n\r\n        try {\r\n            await import_categories($btn.attr('data-nonce'), $btn);\r\n        } catch (error) {\r\n            // Error: restore button\r\n            $btn.prop('disabled', false).text(originalText);\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Expose API for external usage (optional)\r\n     */\r\n    window.PromImporter = {\r\n        RestAPI,\r\n        importProduct: import_product,\r\n        importCategories: import_categories\r\n    };\r\n\r\n    console.log('Prom Importer REST API initialized');\r\n\r\n})(jQuery);\r\n"],"names":["$","RestAPI","namespace","endpoints","product","categories","getUrl","endpoint","promImporterAjaxObj","rest_url","this","getNonce","rest_nonce","wp","apiFetch","nonceMiddleware","nonce","request","data","method","response","fetch","headers","body","JSON","stringify","json","ok","Error","message","error","async","import_product","product_id","product_title","product_description","product_price","product_category","product_featured_media","mediaUrls","trim","parse","e","parseInt","parseFloat","Array","isArray","success","edit_url","window","open","alert","error_text","import_categories","btn","mappings","each","index","row","$row","xmlId","find","eq","text","selectedValue","val","push","id","selected","length","no_categories_text","saved_text","removeClass","attr","prop","addClass","type","dispatch","createNotice","isDismissible","showNotice","on","event","preventDefault","$btn","originalText","loading_text","imported_text","PromImporter","importProduct","importCategories","jQuery"],"ignoreList":[],"sourceRoot":""}